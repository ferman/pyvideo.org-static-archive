





<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="../../static/bootstrap-3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../static/css/richard.css">
  <link rel="stylesheet" href="../../static/browserid/persona-buttons.css" />
  <link rel="search" type="application/opensearchdescription+xml" title="pyvideo.org search" href="../../search/xml">
  <title>pyvideo.org - Amanda: A New Generation of Distributed Services Framework</title>
  <link rel="shortcut icon" type="image/x-icon" href="http://pyvideo.org/favicon.ico">

  
    <meta name="keywords" content="">
  
    <meta name="description" content="To help create award winning visual effects, MPC developed a distributed service-oriented platform, Amanda.
Amanda allows developers of any level to write a service that is presented to users across 8 facilities globally without them requiring any
knowledge of building large concurrent systems. It allows artists and developers across different domains to work with
clearly defined API&#39;s and gives the service developer control over what and how data can and should be accessed. The talk will cover how to set up such a platform from the ground up. Starting at the service level building it out with
additional modules and technologies until the fully distributed system, covering topics such as concurrency, componetisation and monitoring that allow the
fine tuning of setups depending on the type of work being undertaken and changing business needs.">
  

  
</head>
<body>
  <input type='hidden' name='csrfmiddlewaretoken' value='DEhrCXO8g33mPB1YNZ7JRQq9NQMV9Bvc' />
  
<div id="browserid-info"
     style="display: none;"
     data-info="{&quot;loginUrl&quot;: &quot;/browserid/login/&quot;, &quot;requestArgs&quot;: {}, &quot;logoutUrl&quot;: &quot;/browserid/logout/&quot;, &quot;csrfUrl&quot;: &quot;/browserid/csrf/&quot;}">
</div>

  <a name="top"></a>
  <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="../../index.html">pyvideo.org</a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="amanda-a-new-generation-of-distributed-services.html#" class="dropdown-toggle" data-toggle="dropdown">
              Browse <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
              <li><a href="../../category.html">Conferences/user groups</a></li>
              <li><a href="../../speaker/index.html">Speakers</a></li>
            </ul>
          </li>
        </ul>
        <form class="navbar-form navbar-left" role="search" action="../../search.1.html">
          <div class="form-group">
            <input type="hidden" name="models" value="videos.video">
            <input type="text" class="form-control" name="q" placeholder="Search" autofocus value="">
          </div>
        </form>
        

        <ul class="nav navbar-nav navbar-right">
          
            <li><div class="signin">

<a href="amanda-a-new-generation-of-distributed-services.html#" data-next="/" class="browserid-login persona-button" >
	<span>Sign in</span>
</a>
</div></li>
          
        </ul>
      </div>
    </div>
  </nav>

  <div id="content" class="container">
    
      <div class="row">
        <div class="col-md-12">
          
            <div class="alert alert-info">
              <i class="icon-info-sign"></i> <strong>Sorry!</strong>
              <p>pyvideo is closing down at some point in 2016. <a href="http://bluesock.org/~willkg/blog/pyvideo/status_20160115.html">More details</a></p>
            </div>
          
        </div>
      </div>
    

    


<div class="row section" vocab="http://schema.org" typeof="VideoObject">
  <div id="videobox" class="col-md-12">
    
    <div class="clearfix">
      <div class="videobox-inner">
        
          
            <div class="amara-embed" data-height="480px" data-width="854px" data-url="http://www.youtube.com/watch?v=bPNGn1XHCKw"></div>
          
        
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div id="videobox" class="col-md-8">
    <div class="section">
      <h3 class="centered" property="name">Amanda: A New Generation of Distributed Services Framework</h3>
      <link property="thumbnailUrl" href="http://i.ytimg.com/vi/bPNGn1XHCKw/hqdefault.jpg"/>
      <link property="sameAs" href="amanda-a-new-generation-of-distributed-services.html"/>
    </div>

    

    
      <div class="section">
        <h4>Summary</h4>
        <div class="video-details-summary" property="description"><p>To help create award winning visual effects, MPC developed a distributed service-oriented platform, Amanda.
Amanda allows developers of any level to write a service that is presented to users across 8 facilities globally without them requiring any
knowledge of building large concurrent systems. It allows artists and developers across different domains to work with
clearly defined API's and gives the service developer control over what and how data can and should be accessed. The talk will cover how to set up such a platform from the ground up. Starting at the service level building it out with
additional modules and technologies until the fully distributed system, covering topics such as concurrency, componetisation and monitoring that allow the
fine tuning of setups depending on the type of work being undertaken and changing business needs.</p></div>
        <meta property="caption" content="To help create award winning visual effects, MPC developed a distributed service-oriented platform, Amanda.
Amanda allows developers of any level to write a service that is presented to users across 8 facilities globally without them requiring any
knowledge of building large concurrent systems. It allows artists and developers across different domains to work with
clearly defined API&#39;s and gives the service developer control over what and how data can and should be accessed. The talk will cover how to set up such a platform from the ground up. Starting at the service level building it out with
additional modules and technologies until the fully distributed system, covering topics such as concurrency, componetisation and monitoring that allow the
fine tuning of setups depending on the type of work being undertaken and changing business needs."/>
      </div>
    

    

    
      <div class="section">
        <h4>Description</h4>
        <div class="video-details-description"><h1>Presentation outline</h1>
<p>We'll start off with a quick overview of a movie production pipeline which will set the stage
for how Amanda provides artists with the tools they need to develop and streamline the production process
as well as Amanda's crucial function as a robust framework for the support and development teams.
Going over some stats, up to 250.000 service calls a minute during World War Z for example (for frame of reference this is
twice the average rate of stackoverflow.com), I'll highlight some of the problems encountered with the 1st generation.
Initially developed in 2007 and replaced last year it had several flaws in regards to scalability, maintainability and future proofing.
From there I'll introduce the 2nd generation which is build on the principle of componentisation and building blocks. Every part of the system
needs to be replaceable and this needs to be possible from the configuration.</p>
<p>During the presentation we will be stepping through the different building blocks, how they have been set up, how they slot together
and how we monitor, trace and test the system from the ground up. Starting at the lowest level with services we'll slowly
step through the different blocks necessary to build a fault tolerant, distributed and scalable platform.
We made sure that the platform is not tied into any specific technology but allows the use of the best technologies
depending on the type of work being undertaken and changing business needs and technological advances.</p>
<h2>Service development and testing</h2>
<p>Our development teams build applications for artists creating visual effects through to management teams coordinating productions.
A service-based architecture was chosen to provide consistent interfaces across the many different environments where this is required.
We provide an ecosystem where developers of any level can safely write a service (a set of instructions regarding a
specific topic) that are presented to developers and technical artists globally.
To write a service the developer doesn't need any knowledge in regards to building large concurrent systems.
The service is implemented through a simple Python API and the provided ecosystem allows services to exist in a standalone manner.
The service concept was separated from the platform hosting it. This allows hosting in any application that provides a
standard container (a service provider). Extracting this allowed for more rigorous and simple testing of services;
it also allows developers to provide fake versions of their services publicly against which client code can be tested.
The adage Ê»everything as a serviceÊ¼ was applied to the development of internal facilities.
This includes our management tools and the developer console, which presents the documentation of services and methods
available to developers through a web interface.
Infrastructure services were introduced to present an interface to facilities provided to a regular service, for example
databases, configuration and centralized logging.
Services can call other services and, similarly to infrastructures, services can be replaced with different services depending on the configuration.
Services are exposed to a service (or client as we will see later) via a service provider just like in applications.
Setting services up with the above patterns allows developers to iterate quickly and to include services within testing frameworks.
It has also provided a standardized form across projects allowing developers to support and add to unfamiliar code easily.
And last but not least it has given us full abstractions at all levels, users of services do not need to know the code underneath the hood
be it at a service level or at an infrastructure level.</p>
<h2>Building the cluster</h2>
<p>Rather than building a single system, the new architecture defines a set of building blocks for constructing a
distributed service platform. These can provide adapters for best of breed third party tools or, where necessary,
custom implementations of functionality. Configuration is used to determine the number and types of modules to use
and the parameters with which to initialize them. This allows the same platform to be used for small instances at
a developerÊ¼s desk up to a production environment of many nodes. The design enables improved components to be
swapped into the existing system whilst forming the basis for an entirely new design.</p>
<p>Most practical applications require the service provider to handle multiple requests at the same time.
Amanda provides a set of interchangeable concurrency modules. This allows the most appropriate Python model
for parallel processing to be chosen. For work involving heavy I/O work we choose approaches that avoid waiting
for the GIL, for example multiple processes and greenlets/coroutines, whilst for CPU bound work we can use threads
which may prove more performant.  Having the option to choose between mechanisms is important since there is not a
solution that neatly fits all use cases. A pluggable concurrency abstraction also allows integration of new libraries
as they become available. In future this might include the new asyncio (formerly Tulip) core library for Python 3.3+.</p>
<p>To benefit from concurrency, resource pooling, caching etc. we don't always want to execute the service locally to the service provider.
Service proxies implement this behavior; they take the service, method and arguments of a request as their input
and return the result. The proxy should be transparent to the service and service provider components. By chaining
proxies, complex routing schemes can be built or analysis performed on the results returned. Some similarity can be
drawn with middle-ware in the Web Services Gateway Interface (WSGI) specification.
Communication between proxy and service provider is served by the transport. This abstraction provides an
asynchronous interface to underlying technologies â€“ Current implementations include queue based AMQP, ontop of
RabbitMQ, and Ã˜MQ and more naÃ¯ve communications with standard UDP and TCP sockets. Most transports define both client
and server parts of the system â€“ however some, particularly HTTP-based transports, are designed to accept requests directly from external clients.
Requests from external applications commonly use XMLRPC, JSONRPC or straight JSON. Transport implementations can be
interchanged without impacting other components of Amanda or service developers.</p>
<p>In production, a request gateway implemented as a WSGI application fronts the HTTP protocols. Using the standard
web components NGINX and Î¼WSGI we can build a very scalable front end which internally uses the service provider, proxy, transport
pattern to offload the requests to a backend. The gateway can also provide standard web facilities such as template rendering
(through the Jinja2 library1) for general web clients. The gateway was a requirement as requests originate from applications
written in many languages including C++, Python, JavaScript and domain specific languages such as mel. For us it was
important that the client used across all those languages was a proven standard and lightweight. Most requests are served
in near realtime (6ms round trip times) and are presented to the client in a synchronous way so using a frontend that supports a large number
of HTTP like protocols allowed us to keep the clients simple and present the platform to an extremely wide variety of
languages. Additionally, through the frontend, we can render a web page and present that directly if the requests was made
from a browser.</p>
<p>The final behavior of the platform is defined in configuration. This allows the platform to be tuned to suit
the work that a particular service is performing (I/O vs CPU bound). It is important to remember that every single
component mentioned above be it the concurrency, transport, proxies or frontend can be changed, removed, updated without
it impacting the service, the developer or any of the other components that make up the platform.</p>
<p>Also important to mention that internally and externally everything is a queue and presented as a queue. Going from the client
to the frontend there is a queue, from the frontend onto the backend there is a queue etc. all the way down to a request
being read of the transport and stored inside a queue until a concurrency object is ready to handle the request with the
service provider.</p>
<p>This is where we think our platform might take a different approach. Rather than building the platform on top of a single
great technology we didn't want to limit ourselves and be able to use all the other great technologies out there.
There is no perfect solution for all problems but allowing to fine tune the platform according to different problems.
The setup can now evolve in line with technological advancements and changes to the industry.</p>
<h2>Maintenance and Monitoring (5 mins)</h2>
<p>We will walk through how we are using the same setup with services, service providers, proxies and transports to manage
clusters around the globe. Once again for our maintenance and monitoring we made sure everything is done as a service so
that if there is a better tool in the future we could adopt it.</p>
<p>Through leveraging the configuration management and remote execute platform Salt, a new cluster can now be provisioned quickly.
Management is itself provided as a service. Through this system, the current state is available and configuration changed across
all servers globally. This has reduced routine maintenance tasks from a half day to a five-minute task, with less
chance of human error. Monitoring and introspection are provided, as a service, to aid in day-to-day support, tuning and to help
support analysis for future development.</p>
<p>Developers of services can trace requests from when they enter the system, producing a report of the sequence of
methods being called, with the supplied arguments. For each call the time spent to fulfill each request is presented.
Care was taken to minimize the impact of this on return result of the request. Due to everything being a queue we
can collect the metrics after the result has been put back onto the transport and send to the user and thus minimize the impact
of this collection on returning the result of the request
This means that there is no requirement to put the system into a debug mode in order to obtain execution metrics.</p>
<p>With logging being a service we can dynamically change the logging configuration on a per service basis by making a
request to the logging service taking away the need of changing configuration and restarting the service which
often means a problem might have disappeared due to the reset.</p>
<h2>Future/Conclusion (1 min)</h2>
<p>Whilst developing the new generation of the platform there have been a number of possible applications that have
emerged. The way in which we are able to scale the system would be suitable to run in a cloud environment â€“
 especially with the improvements to management allowing new nodes to be provisioned quickly. The ease of writing
and integrating new components would allow integration with infrastructure provided by third-party cloud vendors.
Other areas of interest include a smaller version of the platform running locally on a userÊ¼s workstation and
services for management of generic processes.</p>
<h2>Main technologies and libraries currently used:</h2>
<ul>
<li>Threading</li>
<li>Gevent</li>
<li>Eventlet</li>
<li>Multiprocessing</li>
<li>ZeroMQ</li>
<li>RabbitMQ</li>
<li>uwsgi</li>
<li>Flask</li>
<li>Salt</li>
<li>nginx</li>
</ul></div>
      </div>
    
  </div>

  <div class="col-md-4">
    <div id="sidebar" class="well">
      

      <dl>
        
        <dt>Category</dt>
        <dd>
          <a href="../../category/54/europython-2014.html">EuroPython 2014</a>
        </dd>

        <dt>Speakers</dt>
        <dd>
          
            <div><a href="../../speaker/1449/jozef-van-eenbergen.html">Jozef van Eenbergen</a></div>
            <meta property="author" content="Jozef van Eenbergen"/>
          
        </dd>

        
          <dt>Language</dt>
          <dd>English
            <meta property="inLanguage" content="en"/>
          </dd>
        

        

        
          <dt>Recorded</dt>
          <dd>July 22, 2014
            <meta property="dateCreated" content="2014-07-22"/>
          </dd>
        

        
          <dt>Last updated</dt>
          <dd>Aug. 2, 2014
            <meta property="dateModified" content="2014-08-02T14:33:56.735816"/>
            <meta property="datePublished" content="2014-08-02T14:33:56.735816"/>
          </dd>
        

        <dt>Video origin</dt>
        <dd>
          
            <a href="http://www.youtube.com/watch?v=bPNGn1XHCKw" property="embedUrl">http://www.youtube.com/watch?v=bPNGn1XHCKw</a>
          
        </dd>

        <dt>Download</dt>
        <dd>
          
            No downloadable files.
          
        </dd>

        
          <dt>Metadata</dt>
          <dd>
            <a href="../../api/v2/video/3044">JSON</a>
          </dd>
        

        <dt>Copyright/License Information</dt>
        <dd>
          
            http://creativecommons.org/licenses/by/3.0/
          
        </dd>

        <dt>Tags</dt>
        <dd>
          
            No tags
          
          <meta property="keywords" content="EuroPython 2014"/>
        </dd>
      </dl>
    </div>
  </div>
</div>


    
    <div id="footer">
      <a name="footer"></a>
      <div class="row">
        <div class="col-md-6">
          <p>pyvideo.org</p>
          <p>
            Run by Sheila Miguez and Will Kahn-Greene Questions,
            comments or concerns? Send an email to Will at willkg at
            bluesock dot org.</p>
          <p>
            Powered by <a href="https://github.com/pyvideo/richard">richard</a>.
          </p>
          <p>
            Hosting for the project is graciously provided by
            <a href="http://www.rackspace.com/cloud">Rackspace</a>.
          </p>
        </div>
        <div class="col-md-4">
          <ul class="unstyled">
            <li><a href="../../pages/about.html">About this site</a></li>
            <li><a href="../../stats/index.html">Site stats</a></li>
            <li><a href="http://github.com/pyvideo/pyvideo/issues/new">Report an issue</a></li>
            <li><a href="http://github.com/pyvideo/pyvideo/issues/new">Suggest a conference to add</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <a class="pull-right" href="amanda-a-new-generation-of-distributed-services.html#top">Back to top</a>
        </div>
      </div>
    </div>
    

  </div>

  


  
  <script type="text/javascript" src="../../static/jquery-1.11.0/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="../../static/bootstrap-3.1.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://login.persona.org/include.js"></script>
<script type="text/javascript" src="../../static/browserid/api.js"></script>
<script type="text/javascript" src="../../static/browserid/browserid.js"></script>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29832059-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script type="text/javascript" src="http://amara.org/embedder-iframe"></script>
  <script type="text/javascript" src="../../static/videos/js/videos.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      // react to changes after page load
      $(window).on('hashchange', function() {
        updateVideoOffset('unisubs');
      });

      updateVideoOffset('unisubs');
    });
  </script>

</body>
</html>
